<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Connection Debugger</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>
    <h1>Tindi Tech Connection Debugger</h1>
    <p>This page tests if your browser can talk to the backend server.</p>

    <button onclick="testConnection()">Test Connection Now</button>

    <div id="results"></div>

    <script src="assets/js/site-api.js"></script>
    <script>
        // const API_URL = "http://127.0.0.1:5000";
        const API_URL = window.API_URL;

        async function testConnection() {
            const results = document.getElementById('results');
            results.innerHTML = "Testing...";

            try {
                // 1. Test Simple GET (Health Check)
                const start = Date.now();
                const res = await fetch(API_URL + "/products?limit=1");
                // Using /products as it's a GET request that should be open

                const time = Date.now() - start;

                if (res.ok) {
                    results.innerHTML += `<div class="status success">
                        <strong>✅ Test 1 (Standard): Success!</strong><br>
                        Server is reachable and CORS is good.<br>
                        Time: ${time}ms
                    </div>`;
                } else {
                    results.innerHTML += `<div class="status error">
                        <strong>⚠️ Test 1: Reached Server but Error</strong><br>
                        Status: ${res.status} ${res.statusText}
                    </div>`;
                }
            } catch (err) {
                console.error(err);
                results.innerHTML += `<div class="status error">
                    <strong>❌ Test 1 (Standard): Failed</strong><br>
                    Error: ${err.message}
                </div>`;

                // 2. Test No-CORS (Connectivity Check)
                results.innerHTML += "<br>Testing Network Connectivity (No-CORS mode)...<br>";
                try {
                    await fetch(API_URL + "/products?limit=1", { mode: 'no-cors' });
                    results.innerHTML += `<div class="status success">
                        <strong>✅ Test 2 (No-CORS): Connection Established!</strong><br>
                        This means the server IS running and reachable, but <strong>CORS</strong> is blocking the data.<br>
                        This is a browser security setting issue.
                    </div>`;
                } catch (err2) {
                    results.innerHTML += `<div class="status error">
                        <strong>❌ Test 2 (No-CORS): Failed</strong><br>
                        Error: ${err2.message}<br>
                        <strong>CONCLUSION:</strong> The server is completely unreachable.<br>
                        - Firewall blocking Port 5000?<br>
                        - VPN interfering?<br>
                        - Server process hung?
                    </div>`;
                }
            }
        }

        // Auto-run on load
        testConnection();
    </script>
</body>

</html>